<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GlobalWay - Decentralized Club</title>
    <meta name="description" content="GlobalWay decentralized club platform on opBNB" />

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#001a33" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="GlobalWay" />
    <link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png" />

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/icon-32x32.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192x192.png" />

    <!-- CSS -->
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/components.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- AUTO DEEP-LINK for SafePal (runs early). 
         Behavior:
         - If open on mobile (Android/iOS) and URL contains ?ref= or ?openInWallet=1 then attempt deep-link into SafePal app
         - Only triggers when not already inside SafePal browser
         - Uses a short timeout so normal desktop/tv webviews don't get redirected
    -->
<script>
    (function() {
      try {
        const ua = navigator.userAgent || '';
        const isMobile = /Android|iPhone|iPad|iPod/i.test(ua);
        const isSafePalBrowser = ua.includes('SafePal') || ua.includes('safepal') || window.location.href.includes('safepal');
        const url = new URL(window.location.href);
        
        // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–ï –¥–µ–ª–∞—Ç—å deep-link –µ—Å–ª–∏ –£–ñ–ï –≤ SafePal
        if (isSafePalBrowser) {
          console.log('‚úÖ Already in SafePal browser, skip deep-link');
          return;
        }
      
        // Trigger deep-link –¢–û–õ–¨–ö–û –µ—Å–ª–∏ explicit –ø–∞—Ä–∞–º–µ—Ç—Ä openInWallet=1
        const shouldDeepLink = isMobile && url.searchParams.get('openInWallet') === '1';

        if (!shouldDeepLink) return;

        const encoded = encodeURIComponent(window.location.href);
        const isAndroid = /Android/i.test(ua);
        const deepLink = isAndroid
          ? `safepalwallet://open?url=${encoded}`
          : `safepal://open?url=${encoded}`;

        setTimeout(() => {
          window.location.href = deepLink;
        }, 120);

        setTimeout(() => {
          const storeUrl = /Android/i.test(ua)
            ? 'https://play.google.com/store/apps/details?id=io.safepal.wallet'
            : 'https://apps.apple.com/app/safepal-wallet/id1548297139';
  
          try {
            const wantsInstall = confirm(
              'To continue please install or open SafePal Wallet.\n\nPress OK to open the store.'
            );
            if (wantsInstall) {
              window.open(storeUrl, '_blank');
            }
          } catch (e) {
            // ignore
          }
        }, 2200);
      } catch (e) {
        console.warn('SafePal deeplink helper error', e);
      }
    })();
  </script>
</head>
<body>
<div id="debug" style="position:fixed;top:0;left:0;background:red;color:white;padding:10px;z-index:9999;font-size:12px;">
  Loading...
</div>
    <script>
      window.onerror = function(msg, url, line) {
        document.getElementById('debug').innerHTML = 'Error: ' + msg + '<br>Line: ' + line;
        return true;
      };
      setTimeout(() => {
        const debug = document.getElementById('debug');
        if(debug) debug.innerHTML = 'OK - No errors';
        setTimeout(() => { if(debug) debug.style.display = 'none'; }, 2000);
      }, 3000);
    </script>
    <div id="app">
        <!-- Landing Page -->
        <div id="landing" class="page active">
            <div class="cosmic-bg">
                <img src="assets/images/background.jpg" alt="Earth" class="bg-image" />

                <!-- Language Switcher -->
                <div class="lang-switch">
                    <select id="langSelect">
                        <option value="en">EN</option>
                        <option value="ru">RU</option>
                        <option value="uk">UK</option>
                    </select>
                </div>

                <!-- Floating Planets -->
                <div class="planets-container">
                    <div class="planet" data-planet="club">
                        <img src="assets/planets/planet-club.png" alt="Club" />
                        <span class="planet-label" data-translate="planets.club">Club GlobalWay</span>
                    </div>
                    <div class="planet" data-planet="mission">
                        <img src="assets/planets/planet-mission.png" alt="Mission" />
                        <span class="planet-label" data-translate="planets.mission">Our Mission</span>
                    </div>
                    <div class="planet" data-planet="goals">
                        <img src="assets/planets/planet-goals.png" alt="Goals" />
                        <span class="planet-label" data-translate="planets.goals">Club Goals</span>
                    </div>
                    <div class="planet" data-planet="roadmap">
                        <img src="assets/planets/planet-roadmap.png" alt="Roadmap" />
                        <span class="planet-label" data-translate="planets.roadmap">Roadmap</span>
                    </div>
                    <div class="planet" data-planet="projects">
                        <img src="assets/planets/planet-projects.png" alt="Projects" />
                        <span class="planet-label" data-translate="planets.projects">Our Projects</span>
                    </div>
                </div>

                <!-- Entry Coin -->
                <div class="entry-coin" id="openDapp">
                    <img src="assets/planets/gwt-coin.png" alt="GWT Coin" />
                    <span data-translate="landing.enterDapp">–í—Ö–æ–¥ –≤ Daap</span>
                </div>
            </div>
        </div>

        <!-- Main DApp -->
        <div id="dapp" class="page">
            <!-- Header -->
            <header class="header">
                <div class="logo">
                    <img src="assets/icons/logo.png" alt="GlobalWay" />
                    <span>GlobalWay</span>
                </div>
                <div class="header-info">
                    <div class="header-lang-switch">
                        <select id="langSelectHeader">
                            <option value="en">EN</option>
                            <option value="ru">RU</option>
                            <option value="uk">UK</option>
                        </select>
                    </div>
                    <div id="connectionStatus" class="status-indicator">
                        <span id="connectBtn" data-translate="wallet.connect">Connect Wallet</span>
                    </div>
                </div>
            </header>

            <!-- Navigation -->
            <nav class="main-nav">
                <button class="nav-btn active" data-page="dashboard">
                    <span data-translate="nav.dashboard">Dashboard</span>
                </button>
                <button class="nav-btn" data-page="partners">
                    <span data-translate="nav.partners">Partners</span>
                </button>
                <button class="nav-btn" data-page="matrix">
                    <span data-translate="nav.matrix">Matrix</span>
                </button>
                <button class="nav-btn" data-page="tokens">
                    <span data-translate="nav.tokens">Tokens</span>
                </button>
                <button class="nav-btn" data-page="projects">
                    <span data-translate="nav.projects">Projects</span>
                </button>
                <button class="nav-btn admin-only" data-page="admin" style="display:none;">
                    <i class="icon-settings"></i>
                    <span data-translate="nav.admin">Admin</span>
                </button>
            </nav>

            <!-- Content -->
            <main class="content">
                <!-- Dashboard -->
                <div id="dashboard" class="page-content active">
                    <!-- Personal Cabinet -->
                    <section class="cabinet-info">
                        <h2 data-translate="dashboard.cabinet">üåå –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
                        <div class="info-grid">
                            <div class="info-item">
                                <label data-translate="dashboard.address">–ê–¥—Ä–µ—Å</label>
                                <span id="userAddress">0x000...000</span>
                            </div>
                            <div class="info-item">
                                <label data-translate="dashboard.balance">–ë–∞–ª–∞–Ω—Å</label>
                                <span id="userBalance">0.000 BNB</span>
                            </div>
                            <div class="info-item">
                                <label data-translate="dashboard.userId">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                                <span id="userId">-</span>
                            </div>
                            <div class="info-item">
                                <label data-translate="dashboard.rank">–†–∞–Ω–≥</label>
                                <span id="userRank">-</span>
                            </div>
                        </div>
                        <div class="referral-section">
                            <label data-translate="dashboard.refLink">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</label>
                            <input type="text" id="refLink" readonly />
                            <button id="copyRefLink" data-translate="common.copy">Copy</button>
                        </div>
                    </section>

                    <!-- Quarterly Activity -->
                    <section class="quarterly-activity">
                        <h3 data-translate="dashboard.quarterly">–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                        <div class="activity-info">
                            <div class="activity-item">
                                <span data-translate="dashboard.quarter">–ö–≤–∞—Ä—Ç–∞–ª:</span>
                                <span id="currentQuarter">1</span>
                            </div>
                            <div class="activity-item">
                                <span data-translate="dashboard.nextPayment">–°–ª–µ–¥—É—é—â–∞—è –æ–ø–ª–∞—Ç–∞:</span>
                                <span id="nextPayment">-</span>
                            </div>
                            <div class="activity-item">
                                <span data-translate="dashboard.cost">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                                <span id="quarterlyCost">0.075 BNB</span>
                            </div>
                        </div>
                        <button id="payActivityBtn" class="btn-primary" data-translate="dashboard.payActivity">–û–ø–ª–∞—Ç–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                    </section>

                    <!-- Level Management -->
                    <section class="level-management">
                        <h3 data-translate="dashboard.levelMgmt">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏</h3>
                        <div class="levels-grid">
                            <div class="levels-individual">
                                <h4 data-translate="dashboard.individual">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –ø–æ–∫—É–ø–∫–∞</h4>
                                <div class="levels-row" id="individualLevels">
                                    <!-- Generated levels 1-12 -->
                                </div>
                            </div>
                            <div class="levels-bulk">
                                <h4 data-translate="dashboard.bulk">–ü–∞–∫–µ—Ç–Ω–∞—è –ø–æ–∫—É–ø–∫–∞</h4>
                                <div class="bulk-buttons">
                                    <button class="bulk-btn" data-levels="4">1-4 <span class="price">0.021</span> BNB</button>
                                    <button class="bulk-btn" data-levels="7">1-7 <span class="price">0.117</span> BNB</button>
                                    <button class="bulk-btn" data-levels="10">1-10 <span class="price">0.885</span> BNB</button>
                                    <button class="bulk-btn" data-levels="12">1-12 <span class="price">3.957</span> BNB</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Earnings by Rank -->
                    <section class="earnings-rank">
                        <h3 data-translate="dashboard.earnings">üíé –î–æ—Ö–æ–¥—ã –ø–æ —Ä–∞–Ω–≥–∞–º</h3>
                        <div class="earnings-list" id="earningsRank">
                            <!-- Generated earnings -->
                        </div>
                    </section>

                    <!-- Transaction History -->
                    <section class="transaction-history">
                        <h3 data-translate="dashboard.history">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
                        <div class="history-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th data-translate="common.number">‚Ññ</th>
                                        <th data-translate="common.level">–£—Ä–æ–≤–µ–Ω—å</th>
                                        <th data-translate="common.amount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                        <th data-translate="common.date">–î–∞—Ç–∞</th>
                                        <th>ID</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTable">
                                    <!-- Generated transactions -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Tokens Summary -->
                    <section class="tokens-summary">
                        <h3 data-translate="dashboard.tokens">–¢–æ–∫–µ–Ω—ã</h3>
                        <div class="token-info">
                            <span data-translate="tokens.amount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span>
                            <span id="tokenAmount">0 GWT</span>
                            <span data-translate="tokens.price">–¶–µ–Ω–∞:</span>
                            <span id="tokenPrice">$0.00</span>
                            <button class="btn-secondary" onclick="window.uiManager.showPage('tokens')" data-translate="tokens.manage">–£–ø—Ä–∞–≤–ª—è—Ç—å</button>
                        </div>
                    </section>
                </div>

                <!-- Partners Page -->
                <div id="partners" class="page-content"></div>

                <!-- Matrix Page -->
                <div id="matrix" class="page-content"></div>

                <!-- Tokens Page -->
                <div id="tokens" class="page-content"></div>

                <!-- Projects Page -->
                <div id="projects" class="page-content"></div>

                <!-- Admin Page -->
                <div id="admin" class="page-content admin-only" style="display:none;"></div>
            </main>
        </div>
    </div>

<!-- Modal for Planet Info -->
    <div id="planetModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 id="modalTitle"></h3>
            <p id="modalText"></p>
        </div>
    </div>
<!-- scripts —Å –≤–µ—Ä—Å–∏–µ–π -->
<script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script src="js/config.js?v=1.2.0"></script>
<script src="js/utils.js?v=1.2.0"></script>
<script src="js/i18n.js?v=1.2.0"></script>
<script src="js/web3.js?v=1.2.0"></script>
<script src="js/contracts.js?v=1.2.0"></script>
<script src="js/admin.js?v=1.2.0"></script>
<script src="js/ui.js?v=1.2.0"></script>
<script src="js/app.js?v=1.2.0"></script>
</body>
</html>
